{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="{% static 'admin.css' %}">
</head>
<body>
    <header>
        <div class="top-nav">
            <span class="dashboard-title">Admin Dashboard</span>
            <span class="welcome">Welcome, {{ request.user.first_name }}</span>
            <a href="{% url 'logout' %}" class="logout-btn">Logout</a>
        </div>
    </header>

    <main>
        <div class="side-nav">
            <button class="toggle-btn" onclick="showSection('manage-users')">Users</button>
            <button class="toggle-btn" onclick="showSection('manage-products')">Products</button>
            <button class="toggle-btn" onclick="showSection('manage-operations')">Users & Products Management</button>
        </div>

        <div class="content">
            <div class="dashboard-info">
                <p>Welcome, {{ request.user.first_name }}! Hereâ€™s a quick overview of the system:</p>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <h3>Total Users</h3>
                        <p>{{ users.count }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Products</h3>
                        <p>{{ products.count }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Recent Orders</h3>
                        <p>{{ recent_orders|length }} orders in the last 30 days</p>
                    </div>
                    <div class="stat-card">
                        <h3>Total Sales</h3>
                        <p>${{ total_sales }}</p>
                    </div>
                </div>
            </div>
            
            <div id="manage-users" class="admin-section" style="display:none;">
                <h2>Users</h2>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Full Name</th>
                                <th>Email</th>
                                <th>Designation</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in users %}
                                <tr>
                                    <td>{{ user.username }}</td>
                                    <td>{{ user.first_name }} {{ user.last_name }}</td>
                                    <td>{{ user.email }}</td>
                                    <td>{{ user.profile.designation }}</td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="4" class="empty">No users found.</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="manage-products" class="admin-section">
                <h2>Products</h2>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Product Code</th>
                                <th>Product Name</th>
                                <th>Product Weight</th>
                                <th>Product Price</th>
                                <th>Stock Level</th>
                                <th>Sales Count</th>
                                <th>Order Date</th>
                                <th>Last Purchase</th>
                                <th>Ordered Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for product in products %}
                                <tr>
                                    <td>{{ product.product_code }}</td>
                                    <td>{{ product.name }}</td>
                                    <td>{{ product.product_weight }}</td>
                                    <td>${{ product.price }}</td>
                                    <td>{{ product.stock_level }}</td>
                                    <td>{{ product.sales_count }}</td>
                                    <td>{{ product.order_received }}</td>
                                    <td>{{ product.last_purchase }}</td>
                                    <td>{{ product.ordered }}</td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="9" class="empty">No products found.</td>
                                </tr>
                            {% endfor %}
                            </tbody>                            
                    </table>
                </div>
            </div>

           
            <div id="manage-operations" class="admin-section" style="display:none;">
                <h2>Operations Management</h2>
                <div class="operation-buttons">
                    <!-- User Management -->
                    <button onclick="openModal('add-user-modal')">Add User</button>
                    <button onclick="openModal('update-user-modal')">Update User</button>
                    <button onclick="openModal('delete-user-modal')">Remove User</button>
                    <!-- Product Management -->
                    <button onclick="openModal('add-product-modal')">Add Product</button>
                    <button onclick="openModal('update-product-modal')">Update Product</button>
                    <button onclick="openModal('delete-product-modal')">Remove Product</button>
                </div>
            
                        <!-- User Modals -->
                <div id="add-user-modal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeModal('add-user-modal')">&times;</span>
                        <h3>Add User</h3>
                        <form method="POST" action="{% url 'add_user' %}">
                            {% csrf_token %}
                            <input type="text" name="username" placeholder="Username" required>
                            <input type="text" name="first_name" placeholder="First Name" required>
                            <input type="text" name="last_name" placeholder="Last Name" required>
                            <input type="email" name="email" placeholder="Email" required>
                            <input type="password" name="password" placeholder="Password" required>
                            <input type="password" name="confirm_password" placeholder="Confirm Password" required>
                            <select name="designation" required>
                                <option value="">Select Designation</option>
                                <option value="administrator">Admin</option>
                                <option value="operator">Operator</option>
                            </select>
                            <button type="submit">Add User</button>
                        </form>
                    </div>
                </div>

                    <!-- Modal for selecting and updating a user -->
                <div id="update-user-modal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeModal('update-user-modal')">&times;</span>
                        <h3>Update User</h3>

                        <!-- Form to select user and update their details -->
                        <form id="update-user-form" method="POST" action="{% url 'update_user' 0 %}">
                            {% csrf_token %}
                            <label for="user">Select User:</label>
                            <select id="user" name="user" required>
                                <option value="">Select a User</option>
                                {% for user in users %}
                                    <option value="{{ user.id }}">{{ user.username }}</option>
                                {% endfor %}
                            </select>

                            <div id="user-details" style="display: none;">
                                <input type="text" name="username" placeholder="Enter Username" required>
                                <input type="text" name="first_name" placeholder="New First Name">
                                <input type="text" name="last_name" placeholder="New Last Name">
                                <input type="email" name="email" placeholder="New Email">
                                <select name="designation">
                                    <option value="administrator">Admin</option>
                                    <option value="operator">Operator</option>
                                </select>
                                <button type="submit">Update User</button>
                            </div>
                        </form>
                    </div>
                </div>


                <!-- Modal for deleting a user -->
                <div id="delete-user-modal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeModal('delete-user-modal')">&times;</span>
                        <h3>Remove User</h3>
                        <form method="POST" action="{% url 'delete_user' %}">
                            {% csrf_token %}
                            <input type="text" name="username" placeholder="Enter Username to Remove" required>
                            <button type="submit">Remove User</button>
                        </form>
                    </div>
                </div>


            
                <!-- Add Product Modal -->
                <div id="add-product-modal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeModal('add-product-modal')">&times;</span>
                        <h3>Add Product</h3>
                        <form method="POST" action="{% url 'add_product' %}">
                            {% csrf_token %}
                            <input type="text" name="product_code" placeholder="Product Code" required>
                            <input type="text" name="name" placeholder="Product Name" required>
                            <input type="text" name="product_weight" placeholder="Product Weight" required>
                            <textarea name="description" placeholder="Product Description"></textarea>
                            <input type="number" name="price" placeholder="Price" required step="0.01">
                            <input type="number" name="stock_level" placeholder="Stock Quantity" required>
                            <input type="date" name="order" placeholder="Order Date">
                            <input type="date" name="last_purchase" placeholder="Last Purchase Date">
                            <input type="date" name="ordered" placeholder="Ordered Date">
                            <button type="submit">Add Product</button>
                        </form>
                    </div>
                </div>

            
                <div id="update-product-modal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeModal('update-product-modal')">&times;</span>
                        <h3>Update Product</h3>
                
                        <!-- Display messages -->
                        {% if messages %}
                            <div class="messages">
                                {% for message in messages %}
                                    <p>{{ message }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                
                        <!-- Product selection dropdown -->
                        <form id="update-product-form" method="POST" action="">
                            {% csrf_token %}
                            <label for="product_id">Select Product:</label>
                            <select name="product_id" id="product_id" required>
                                <option value="" disabled selected>Select a product</option>
                                {% for product in products %}
                                    <option value="{{ product.id }}">{{ product.name }}</option>
                                {% endfor %}
                            </select>
                
                            <div id="product-details" style="display: none;">
                                <label for="product_code">Product Code:</label>
                                <input type="text" id="product_code" name="product_code" required>

                
                                <label for="name">Name:</label>
                                <input type="text" id="name" name="name" required>
                
                                <label for="product_weight">Weight:</label>
                                <input type="text" id="product_weight" name="product_weight">
                
                                <label for="price">Price:</label>
                                <input type="number" id="price" name="price" step="0.01" required>
                
                                <label for="stock_level">Stock Level:</label>
                                <input type="number" id="stock_level" name="stock_level">
                
                                <label for="sales_count">Sales Count:</label>
                                <input type="number" id="sales_count" name="sales_count">
                
                                <label for="order">Order Received:</label>
                                <input type="date" id="order" name="order">
                
                                <label for="last_purchase">Last Purchase:</label>
                                <input type="date" id="last_purchase" name="last_purchase">
                
                                <label for="ordered">Ordered:</label>
                                <input type="date" id="ordered" name="ordered">
                
                                <button type="submit">Update Product</button>
                            </div>
                        </form>
                    </div>
                </div>                
                

                <!-- Modal for entering product code and deleting product -->
                <div id="delete-product-modal" class="modal">
                    <div class="modal-content">
                        <span class="close" onclick="closeModal('delete-product-modal')">&times;</span>
                        <h3>Remove Product</h3>
                        
                        <!-- Form to delete product by product_code -->
                        <form method="POST" action="{% url 'delete_product' %}">
                            {% csrf_token %}
                            <label for="product_code">Enter Product Code to Remove:</label>
                            <input type="text" name="product_code" placeholder="Enter Product Code" required>
                            <button type="submit">Remove Product</button>
                        </form>
                    </div>
                </div>
                 
            </div>
            
        </div>
    </main>

    <footer>
        <p>ROOTED GURU POINT OF SALE SYSTEM</p>
    </footer>

    <script src="{% static 'admin.js' %}"></script>
</body>
</html>
